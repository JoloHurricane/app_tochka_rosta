{"ast":null,"code":"import _toConsumableArray from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useContext,useState,useCallback}from\"react\";import ArticleFormFields from\"./ArticleFormFields\";import{useParams}from'react-router-dom';import{AuthContext}from'../context/AuthContext';import{useHttp}from\"../hooks/http.hook\";import{useMessage}from\"../hooks/message.hook\";import{Loader}from'../components/Loader';import M from\"materialize-css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var paramId='';function ArticleFormEdit(){var currentRoute=window.location.pathname;var auth=useContext(AuthContext);var articleId=useParams().id;var message=useMessage();var _useHttp=useHttp(),loading=_useHttp.loading,error=_useHttp.error,request=_useHttp.request,clearError=_useHttp.clearError;var _useState=useState({title:'',text:'',date:'',_id:''}),_useState2=_slicedToArray(_useState,2),form=_useState2[0],setForm=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),id=_useState4[0],setId=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),searchTerm=_useState6[0],setSearchTerm=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),articles=_useState8[0],setArticles=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),file=_useState10[0],setFile=_useState10[1];function submitHandler(event){event.preventDefault();}useEffect(function(){var elems=document.querySelectorAll('.modal');var instances=M.Modal.init(elems,{});});useEffect(function(){window.M.updateTextFields();});var handleSelect=function handleSelect(e){setId(e.target.value);};var handleSearch=function handleSearch(e){setSearchTerm(e.target.value);};var changeHandler=function changeHandler(e){setForm(_objectSpread(_objectSpread({},form),{},_defineProperty({},e.target.name,e.target.value)));};var handleImageChange=function handleImageChange(e){e.preventDefault();var file=e.target.files[0];setFile(file);};var fetchArticles=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var fetched;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return request('/api/articles-edit/articles','GET',null);case 3:fetched=_context.sent;setArticles(fetched);_context.next=9;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);case 9:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);})),[request]);useEffect(function(){message(error);clearError();},[error,message,clearError]);useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:fetchArticles();case 1:case\"end\":return _context2.stop();}}},_callee2);})),[fetchArticles]);useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _currentRoute,fetched;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_currentRoute=window.location.pathname;if(!(_currentRoute!=='/admpage/article-update')){_context3.next=7;break;}_context3.next=5;return request(\"/api/articles-edit/\".concat(articleId),'GET',null);case 5:fetched=_context3.sent;setForm(_objectSpread(_objectSpread({},form),{},{title:fetched.title,date:fetched.createdAt,text:fetched.sanitizedHtml}));case 7:_context3.next=11;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);})),[request]);useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var fetched;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(id!=='')){_context4.next=5;break;}_context4.next=3;return request(\"/api/articles-edit/\".concat(id),'GET',null);case 3:fetched=_context4.sent;setForm(_objectSpread(_objectSpread({},form),{},{title:fetched.title,date:fetched.createdAt,text:fetched.sanitizedHtml}));case 5:case\"end\":return _context4.stop();}}},_callee4);})),[id,request]);var deleteHandler=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var data,_data,newArr;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;if(!(articleId!==undefined)){_context5.next=8;break;}_context5.next=4;return request(\"/api/articles-edit/delete/\".concat(articleId),'POST',{},{},'application/json');case 4:data=_context5.sent;message(data.message);_context5.next=15;break;case 8:_context5.next=10;return request(\"/api/articles-edit/delete/\".concat(id),'POST',{},{},'application/json');case 10:_data=_context5.sent;message(_data.message);newArr=articles.filter(function(elem){return elem._id!==id;});setArticles(_toConsumableArray(newArr));setForm({title:'',text:'',date:''});case 15:_context5.next=19;break;case 17:_context5.prev=17;_context5.t0=_context5[\"catch\"](0);case 19:case\"end\":return _context5.stop();}}},_callee5,null,[[0,17]]);}));return function deleteHandler(){return _ref5.apply(this,arguments);};}();var updateHandler=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var dataForm,data,_data2,newArr,newArrFull,imgdata;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;dataForm=new FormData();dataForm.append(\"file\",file);if(!(articleId!==undefined)){_context6.next=10;break;}_context6.next=6;return request(\"/api/articles-edit/update/\".concat(articleId),'POST',_objectSpread({},form),{},'application/json');case 6:data=_context6.sent;message(data.message);_context6.next=18;break;case 10:_context6.next=12;return request(\"/api/articles-edit/update/\".concat(id),'POST',_objectSpread({},form),{},'application/json');case 12:_data2=_context6.sent;message(_data2.message);newArr=articles.filter(function(elem){return elem._id==id;});newArr[0].title=form.title;newArrFull=articles.filter(function(elem){return elem._id!==id;});setArticles([].concat(_toConsumableArray(newArr),_toConsumableArray(newArrFull)));case 18:if(!(file!==undefined)){_context6.next=23;break;}_context6.next=21;return request('/api/articles-edit/upload-img','POST',dataForm,{});case 21:imgdata=_context6.sent;message(imgdata.message);case 23:_context6.next=27;break;case 25:_context6.prev=25;_context6.t0=_context6[\"catch\"](0);case 27:case\"end\":return _context6.stop();}}},_callee6,null,[[0,25]]);}));return function updateHandler(){return _ref6.apply(this,arguments);};}();if(loading){return/*#__PURE__*/_jsx(Loader,{});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{id:\"modal1\",class:\"modal\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"modal-content\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0436\\u0434\\u0435\\u043D\\u0438\\u0435 \\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u0412\\u044B \\u0442\\u043E\\u0447\\u043D\\u043E \\u0445\\u043E\\u0442\\u0438\\u0442\\u0435 \\u0443\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C?\"})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"a\",{href:\"#!\",class:\"modal-close waves-effect waves-green btn-flat\",children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"a\",{onClick:deleteHandler,href:\"#!\",class:\"modal-close waves-effect waves-green btn-flat\",children:\"\\u0421\\u043E\\u0433\\u043B\\u0430\\u0441\\u0435\\u043D\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"adm-form col s12 m12\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,method:\"post\",encType:\"multipart/form-data\",children:[/*#__PURE__*/_jsx(ArticleFormFields,{changeHandler:changeHandler,state:form,idSelect:id,handleImageChange:handleImageChange,handleSearch:handleSearch,handleSelect:handleSelect,articles:articles,stateSearch:searchTerm,title:\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u043D\\u043E\\u0432\\u043E\\u0441\\u0442\\u0438\",articleId:articleId,currentRoute:currentRoute}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"input-field col s3 offset-s5  m2 offset-m5  l1 offset-l4  btn-form\",children:/*#__PURE__*/_jsx(\"button\",{disabled:loading,type:\"submit\",className:\"btn blue waves-effect waves-light\",onClick:updateHandler,children:\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"input-field col s3 offset-s5  m2 offset-m5  l1 offset-l4  btn-form\",children:/*#__PURE__*/_jsx(\"button\",{disabled:loading,type:\"submit\",style:{marginLeft:'20px'},className:\"btn red accent-3 waves-effect waves-light modal-trigger\",\"data-target\":\"modal1\",children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})})]})]})})})]});}export default ArticleFormEdit;","map":{"version":3,"sources":["C:/react projects/reactExpress/client/src/components/ArticleFormEdit.js"],"names":["React","useEffect","useContext","useState","useCallback","ArticleFormFields","useParams","AuthContext","useHttp","useMessage","Loader","M","paramId","ArticleFormEdit","currentRoute","window","location","pathname","auth","articleId","id","message","loading","error","request","clearError","title","text","date","_id","form","setForm","setId","searchTerm","setSearchTerm","articles","setArticles","file","setFile","submitHandler","event","preventDefault","elems","document","querySelectorAll","instances","Modal","init","updateTextFields","handleSelect","e","target","value","handleSearch","changeHandler","name","handleImageChange","files","fetchArticles","fetched","createdAt","sanitizedHtml","deleteHandler","undefined","data","newArr","filter","elem","updateHandler","dataForm","FormData","append","newArrFull","imgdata","marginLeft"],"mappings":"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","sourcesContent":["import React ,{useEffect,useContext,useState,useCallback} from \"react\";\r\nimport ArticleFormFields from \"./ArticleFormFields\";\r\nimport {useParams} from 'react-router-dom'\r\nimport { AuthContext } from '../context/AuthContext'\r\nimport {useHttp} from \"../hooks/http.hook\" \r\nimport {useMessage} from \"../hooks/message.hook\"\r\nimport {Loader} from '../components/Loader'\r\nimport M from \"materialize-css\"\r\n\r\n\r\nlet paramId = ''\r\n\r\nfunction ArticleFormEdit(){\r\n    const currentRoute= window.location.pathname\r\n    const auth = useContext(AuthContext)\r\n    const articleId = useParams().id\r\n    const message = useMessage()\r\n    const {loading,error,request,clearError} = useHttp()\r\n    const [form,setForm] = useState({\r\n      title:'',\r\n      text:'',\r\n      date:'',\r\n      _id:'',\r\n    })\r\n    const [id,setId] = useState('') \r\n    const [searchTerm,setSearchTerm] = useState('')\r\n    const [articles, setArticles] = useState([])\r\n    const [file,setFile] = useState()\r\n\r\n    function submitHandler(event){\r\n        event.preventDefault()\r\n    }\r\n\r\n  \r\n    useEffect(()=>{\r\n      var elems = document.querySelectorAll('.modal');\r\n      var instances = M.Modal.init(elems, {});\r\n    })\r\n    useEffect(() => {\r\n        window.M.updateTextFields()\r\n      },)\r\n\r\n    const handleSelect=(e)=>{\r\n      \r\n        setId(e.target.value)\r\n        \r\n        \r\n    }\r\n    const handleSearch=(e)=>{\r\n        setSearchTerm(e.target.value)\r\n    }\r\n\r\n    \r\n\r\n      const changeHandler = e=>{\r\n        setForm({...form, [e.target.name]: e.target.value})\r\n      }  \r\n\r\n      \r\n      const handleImageChange= e=> {\r\n        e.preventDefault();\r\n     \r\n         const file = e.target.files[0]\r\n         setFile(file)\r\n\r\n         \r\n       }\r\n\r\n\r\n          const fetchArticles = useCallback(async () => {\r\n            try {\r\n                const fetched = await request('/api/articles-edit/articles', 'GET', null)\r\n                setArticles(fetched)\r\n               \r\n               \r\n        } catch (e) {}\r\n      }, [request])\r\n\r\n     \r\n\r\n      useEffect(()=>{\r\n        message(error)\r\n        clearError()\r\n      },[error,message,clearError])\r\n      \r\n      useEffect( async () => {\r\n        fetchArticles()\r\n        \r\n      }, [fetchArticles])\r\n\r\n        useEffect( async() => {\r\n        \r\n            try {\r\n                const currentRoute= window.location.pathname\r\n                if(currentRoute!=='/admpage/article-update'){\r\n                    const fetched = await request(`/api/articles-edit/${articleId}`, 'GET', null)\r\n                    setForm({...form,title:fetched.title,date:fetched.createdAt,text:fetched.sanitizedHtml})\r\n                }\r\n               \r\n               \r\n              } catch (e) {}\r\n          },[request])\r\n\r\n\r\n          useEffect(async()=>{\r\n              if (id!==''){\r\n                const fetched = await request(`/api/articles-edit/${id}`, 'GET', null)\r\n                    setForm({...form,title:fetched.title,date:fetched.createdAt,text:fetched.sanitizedHtml})\r\n          \r\n              }\r\n                    \r\n          },[id,request])\r\n\r\n\r\n          const deleteHandler = async()=>{\r\n              try{\r\n                \r\n                if(articleId!==undefined){\r\n                  const data=await request(`/api/articles-edit/delete/${articleId}`,'POST',{} , \r\n                  {},'application/json')\r\n                  message(data.message)\r\n                }else{\r\n                 const  data=await request(`/api/articles-edit/delete/${id}`,'POST',{} , \r\n                {},'application/json')\r\n                message(data.message)\r\n                const newArr = articles.filter(elem => elem._id !== id)\r\n                setArticles([...newArr])\r\n                setForm({title:'',text:'',date:''})\r\n                }\r\n                \r\n               \r\n              }catch(e){}\r\n          }\r\n    \r\n          const updateHandler= async ()=>{\r\n            try{\r\n         \r\n              const dataForm = new FormData()\r\n              dataForm.append(\"file\", file)\r\n              if (articleId!==undefined){\r\n                const data=await request(`/api/articles-edit/update/${articleId}`,'POST',{...form} , \r\n                {},'application/json')\r\n                message(data.message)\r\n              }\r\n              else{\r\n                const  data=await request(`/api/articles-edit/update/${id}`,'POST',{...form} , \r\n                {},'application/json')\r\n                message(data.message)\r\n                const newArr = articles.filter(elem => elem._id == id)\r\n                newArr[0].title=form.title\r\n                const newArrFull=articles.filter(elem => elem._id !== id)\r\n                setArticles([...newArr,...newArrFull])\r\n                \r\n              }\r\n             \r\n              \r\n                if (file !== undefined){\r\n                    const imgdata = await request('/api/articles-edit/upload-img','POST',dataForm, \r\n                    {},)\r\n                    message(imgdata.message)\r\n                }\r\n            \r\n              \r\n            }catch(e){\r\n      \r\n            }\r\n        }\r\n        if (loading) {\r\n            return <Loader/>\r\n          }\r\n\r\n         \r\n    return(\r\n        <>\r\n        <div id=\"modal1\" class=\"modal\">\r\n            <div class=\"modal-content\">\r\n              <h4>Подтверждение действия</h4>\r\n              <p>Вы точно хотите удалить?</p>\r\n            </div>\r\n            <div class=\"modal-footer\">\r\n            <a  href=\"#!\" class=\"modal-close waves-effect waves-green btn-flat\">Закрыть</a>\r\n              <a onClick={deleteHandler} href=\"#!\" class=\"modal-close waves-effect waves-green btn-flat\">Согласен</a>\r\n            </div>\r\n        </div>\r\n             <div className=\"row\">\r\n            \r\n            <div className=\"adm-form col s12 m12\">\r\n           \r\n                <form onSubmit={submitHandler} method=\"post\" encType=\"multipart/form-data\">\r\n               \r\n                        <ArticleFormFields \r\n                        changeHandler={changeHandler} \r\n                        state={form}\r\n                        idSelect={id} \r\n                        handleImageChange={handleImageChange}\r\n                        handleSearch={handleSearch}\r\n                        handleSelect={handleSelect}\r\n                        articles={articles}\r\n                        stateSearch={searchTerm}\r\n                        title=\"Обновление новости\"\r\n                        articleId={articleId}\r\n                        currentRoute={currentRoute}\r\n                        />\r\n                     <div className=\"row\">\r\n                    <div  className=\"input-field col s3 offset-s5  m2 offset-m5  l1 offset-l4  btn-form\">\r\n                        <button disabled={loading} \r\n                        type=\"submit\" \r\n\r\n                        className=\"btn blue waves-effect waves-light\" \r\n                        onClick={updateHandler}>Обновить</button>\r\n                    </div>\r\n                    <div  className=\"input-field col s3 offset-s5  m2 offset-m5  l1 offset-l4  btn-form\">\r\n                        <button disabled={loading} \r\n                        type=\"submit\" \r\n                        style={{marginLeft:'20px'}}\r\n                        className=\"btn red accent-3 waves-effect waves-light modal-trigger\" \r\n                        \r\n                        data-target=\"modal1\">Удалить</button>\r\n                    </div>\r\n                \r\n             \r\n                   \r\n                           \r\n                    </div>\r\n                </form>\r\n                  \r\n            </div>\r\n        </div>\r\n        </>\r\n\r\n    )\r\n}\r\n\r\nexport default ArticleFormEdit"]},"metadata":{},"sourceType":"module"}