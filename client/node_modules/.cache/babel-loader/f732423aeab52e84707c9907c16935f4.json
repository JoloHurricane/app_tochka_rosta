{"ast":null,"code":"import _toConsumableArray from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useContext,useState,useCallback}from'react';import GalleryCategoryFormFields from'./GalleryCategoryFormFields';import{useParams}from'react-router-dom';import{AuthContext}from'../context/AuthContext';import{useHttp}from\"../hooks/http.hook\";import{useMessage}from\"../hooks/message.hook\";import{Loader}from'../components/Loader';import M from\"materialize-css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function GalleryCategoryFormEdit(){function submitHandler(event){event.preventDefault();}var auth=useContext(AuthContext);var categoryId=useParams().id;var currentRoute=window.location.pathname;var message=useMessage();var _useHttp=useHttp(),loading=_useHttp.loading,error=_useHttp.error,request=_useHttp.request,clearError=_useHttp.clearError;var _useState=useState({title:'',description:''}),_useState2=_slicedToArray(_useState,2),form=_useState2[0],setForm=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),categories=_useState4[0],setCategories=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),file=_useState6[0],setFile=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),searchTerm=_useState8[0],setSearchTerm=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),id=_useState10[0],setId=_useState10[1];var handleSearch=function handleSearch(e){setSearchTerm(e.target.value);};var handleSelect=function handleSelect(e){setId(e.target.value);};function submitHandler(event){event.preventDefault();}useEffect(function(){var elems=document.querySelectorAll('.modal');var instances=M.Modal.init(elems,{});});useEffect(function(){window.M.updateTextFields();});useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _currentRoute,fetched;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_currentRoute=window.location.pathname;if(!(_currentRoute!=='/admpage/galleryCategory-update')){_context.next=8;break;}_context.next=5;return request(\"/api/galleryCategory-edit/\".concat(categoryId),'GET',null);case 5:fetched=_context.sent;setForm(_objectSpread(_objectSpread({},form),{},{title:fetched.title,description:fetched.description}));setId(fetched._id);case 8:_context.next=12;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);})),[request]);var fetchCategories=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var fetched;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return request('/api/galleryCategory-edit/gallery-categories','GET',null);case 3:fetched=_context2.sent;setCategories(fetched);_context2.next=9;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);case 9:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);})),[request]);useEffect(function(){fetchCategories();},[fetchCategories]);useEffect(function(){message(error);clearError();},[error,message,clearError]);var changeHandler=function changeHandler(e){setForm(_objectSpread(_objectSpread({},form),{},_defineProperty({},e.target.name,e.target.value)));};var handleImageChange=function handleImageChange(e){e.preventDefault();var file=e.target.files[0];setFile(file);};useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var fetched;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(id!=='')){_context3.next=5;break;}_context3.next=3;return request(\"/api/galleryCategory-edit/\".concat(id),'GET',null);case 3:fetched=_context3.sent;setForm(_objectSpread(_objectSpread({},form),{},{title:fetched.title,description:fetched.description}));case 5:case\"end\":return _context3.stop();}}},_callee3);})),[id,request]);var deleteHandler=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var data,_data,newArr;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;if(!(categoryId!==undefined)){_context4.next=8;break;}_context4.next=4;return request(\"/api/galleryCategory-edit/delete/\".concat(categoryId),'POST',{},{},'application/json');case 4:data=_context4.sent;message(data.message);_context4.next=15;break;case 8:_context4.next=10;return request(\"/api/galleryCategory-edit/delete/\".concat(id),'POST',{},{},'application/json');case 10:_data=_context4.sent;message(_data.message);newArr=categories.filter(function(elem){return elem._id!==id;});setCategories(_toConsumableArray(newArr));setForm({title:'',description:''});case 15:_context4.next=19;break;case 17:_context4.prev=17;_context4.t0=_context4[\"catch\"](0);case 19:case\"end\":return _context4.stop();}}},_callee4,null,[[0,17]]);}));return function deleteHandler(){return _ref4.apply(this,arguments);};}();var updateHandler=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var dataForm,data,_data2,newArr,newArrFull,imgdata;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;dataForm=new FormData();dataForm.append(\"file\",file);if(!(categoryId!==undefined)){_context5.next=10;break;}_context5.next=6;return request(\"/api/galleryCategory-edit/update/\".concat(categoryId),'POST',_objectSpread({},form),{},'application/json');case 6:data=_context5.sent;message(data.message);_context5.next=18;break;case 10:_context5.next=12;return request(\"/api/galleryCategory-edit/update/\".concat(id),'POST',_objectSpread({},form),{},'application/json');case 12:_data2=_context5.sent;message(_data2.message);newArr=categories.filter(function(elem){return elem._id==id;});newArr[0].title=form.title;newArrFull=categories.filter(function(elem){return elem._id!==id;});setCategories([].concat(_toConsumableArray(newArr),_toConsumableArray(newArrFull)));case 18:if(!(file!==undefined)){_context5.next=23;break;}_context5.next=21;return request('/api/galleryCategory-edit/upload-img','POST',dataForm,{});case 21:imgdata=_context5.sent;message(imgdata.message);case 23:_context5.next=27;break;case 25:_context5.prev=25;_context5.t0=_context5[\"catch\"](0);case 27:case\"end\":return _context5.stop();}}},_callee5,null,[[0,25]]);}));return function updateHandler(){return _ref5.apply(this,arguments);};}();if(loading){return/*#__PURE__*/_jsx(Loader,{});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{id:\"modal1\",class:\"modal\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"modal-content\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0436\\u0434\\u0435\\u043D\\u0438\\u0435 \\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u0412\\u044B \\u0442\\u043E\\u0447\\u043D\\u043E \\u0445\\u043E\\u0442\\u0438\\u0442\\u0435 \\u0443\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C?\"})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"a\",{href:\"#!\",class:\"modal-close waves-effect waves-green btn-flat\",children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"a\",{onClick:deleteHandler,href:\"#!\",class:\"modal-close waves-effect waves-green btn-flat\",children:\"\\u0421\\u043E\\u0433\\u043B\\u0430\\u0441\\u0435\\u043D\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"adm-form col s12 m12\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,method:\"post\",enctype:\"multipart/form-data\",children:[/*#__PURE__*/_jsx(GalleryCategoryFormFields,{changeHandler:changeHandler,state:form,handleImageChange:handleImageChange,handleSearch:handleSearch,handleSelect:handleSelect,title:\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u0441\\u043E\\u0431\\u044B\\u0442\\u0438\\u044F\",categories:categories,stateSearch:searchTerm,categoryId:categoryId,currentRoute:currentRoute}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"input-field col s3 offset-s5  m2 offset-m5  l1 offset-l4  btn-form\",children:/*#__PURE__*/_jsx(\"button\",{onClick:updateHandler,type:\"submit\",className:\"btn blue waves-effect waves-light\",children:\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C\"})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-delete col s1 offset-s5  m1 offset-m5  l1 offset-l4 \",children:/*#__PURE__*/_jsx(\"form\",{onSubmit:submitHandler,method:\"post\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn red accent-3 waves-effect waves-light modal-trigger\",\"data-target\":\"modal1\",children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})})})]})})]});}export default GalleryCategoryFormEdit;","map":{"version":3,"sources":["C:/react projects/reactExpress/client/src/components/GalleryCategoryFormEdit.js"],"names":["React","useEffect","useContext","useState","useCallback","GalleryCategoryFormFields","useParams","AuthContext","useHttp","useMessage","Loader","M","GalleryCategoryFormEdit","submitHandler","event","preventDefault","auth","categoryId","id","currentRoute","window","location","pathname","message","loading","error","request","clearError","title","description","form","setForm","categories","setCategories","file","setFile","searchTerm","setSearchTerm","setId","handleSearch","e","target","value","handleSelect","elems","document","querySelectorAll","instances","Modal","init","updateTextFields","fetched","_id","fetchCategories","changeHandler","name","handleImageChange","files","deleteHandler","undefined","data","newArr","filter","elem","updateHandler","dataForm","FormData","append","newArrFull","imgdata"],"mappings":"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","sourcesContent":["import React, {useEffect,useContext,useState,useCallback} from 'react'\r\nimport GalleryCategoryFormFields from './GalleryCategoryFormFields'\r\nimport {useParams} from 'react-router-dom'\r\nimport { AuthContext } from '../context/AuthContext'\r\nimport {useHttp} from \"../hooks/http.hook\" \r\nimport {useMessage} from \"../hooks/message.hook\"\r\nimport {Loader} from '../components/Loader'\r\nimport M from \"materialize-css\"\r\n\r\n\r\nfunction GalleryCategoryFormEdit(){\r\n    function submitHandler(event){\r\n        event.preventDefault()\r\n    }\r\n\r\n    const auth = useContext(AuthContext)\r\n    const categoryId = useParams().id\r\n    const currentRoute = window.location.pathname\r\n    const message = useMessage()\r\n    const {loading,error,request,clearError} = useHttp()\r\n    const [form,setForm] = useState({\r\n      title:'',\r\n      description:'',\r\n      \r\n    }) \r\n    const [categories, setCategories] = useState([])\r\n    const [file,setFile] = useState()\r\n    const [searchTerm,setSearchTerm] = useState('')\r\n    const [id,setId] = useState('') \r\n    \r\n  const handleSearch=(e)=>{\r\n    setSearchTerm(e.target.value)\r\n}\r\n  const handleSelect=(e)=>{\r\n  setId(e.target.value)\r\n  \r\n  }\r\n    \r\n\r\n        function submitHandler(event){\r\n            event.preventDefault()\r\n        }\r\n\r\n        useEffect(()=>{\r\n          var elems = document.querySelectorAll('.modal');\r\n          var instances = M.Modal.init(elems, {});\r\n        })\r\n        useEffect(() => {\r\n            window.M.updateTextFields()\r\n          },)\r\n\r\n        useEffect(  async() => {\r\n        \r\n            try {\r\n                const currentRoute= window.location.pathname\r\n                if(currentRoute!=='/admpage/galleryCategory-update'){\r\n                    const fetched = await request(`/api/galleryCategory-edit/${categoryId}`, 'GET', null)\r\n                    setForm({...form,title:fetched.title,description:fetched.description})\r\n                    setId(fetched._id)\r\n                }\r\n              \r\n              } catch (e) {}\r\n          },[request])\r\n\r\n        const fetchCategories = useCallback(async () => {\r\n          try {\r\n                const fetched = await request('/api/galleryCategory-edit/gallery-categories', 'GET', null)\r\n                setCategories(fetched)\r\n                \r\n               \r\n        } catch (e) {}\r\n      }, [request])\r\n      \r\n      useEffect(() => {\r\n        fetchCategories()\r\n        \r\n      }, [fetchCategories])\r\n    \r\n    \r\n\r\n        useEffect(()=>{\r\n            message(error)\r\n            clearError()\r\n          },[error,message,clearError])\r\n\r\n          const changeHandler = e=>{\r\n            setForm({...form, [e.target.name]: e.target.value})\r\n          }  \r\n\r\n          const handleImageChange= e=> {\r\n           e.preventDefault();\r\n        \r\n            const file = e.target.files[0]\r\n            \r\n            setFile(file)\r\n\r\n            \r\n          }\r\n          useEffect(async()=>{\r\n            if (id!==''){\r\n              const fetched = await request(`/api/galleryCategory-edit/${id}`, 'GET', null)\r\n                  setForm({...form,title:fetched.title,description:fetched.description})\r\n        \r\n            }\r\n               \r\n              \r\n        },[id,request])\r\n\r\n          const deleteHandler = async()=>{\r\n              try{\r\n                \r\n                if(categoryId!==undefined){\r\n                  const data=await request(`/api/galleryCategory-edit/delete/${categoryId}`,'POST',{} , \r\n                  { },'application/json')\r\n                  message(data.message)\r\n                }else{\r\n                   const data=await request(`/api/galleryCategory-edit/delete/${id}`,'POST',{} , \r\n                  { },'application/json')\r\n                  message(data.message)\r\n                  const newArr = categories.filter(elem => elem._id !== id)\r\n                  setCategories([...newArr])\r\n                  setForm({title:'',description:'',})\r\n                }\r\n                \r\n               \r\n              }catch(e){}\r\n          }\r\n    \r\n          const updateHandler= async ()=>{\r\n            try{\r\n              const dataForm = new FormData()\r\n              dataForm.append(\"file\", file)\r\n           \r\n              if (categoryId!==undefined){\r\n                  const data=await request(`/api/galleryCategory-edit/update/${categoryId}`,'POST',{...form} , \r\n              {},'application/json')\r\n              message(data.message)\r\n              }else{\r\n                const data=await request(`/api/galleryCategory-edit/update/${id}`,'POST',{...form} , \r\n              {},'application/json')\r\n                  message(data.message)\r\n                  const newArr = categories.filter(elem => elem._id == id)\r\n                  newArr[0].title=form.title\r\n                  const newArrFull=categories.filter(elem => elem._id !== id)\r\n                  setCategories([...newArr,...newArrFull])\r\n              }\r\n            \r\n                if (file !== undefined){\r\n                    const imgdata = await request('/api/galleryCategory-edit/upload-img','POST',dataForm, \r\n                    {},)\r\n                    message(imgdata.message)\r\n                }\r\n            \r\n              \r\n            }catch(e){\r\n      \r\n            }\r\n        }\r\n        if (loading) {\r\n          return <Loader/>\r\n        }\r\n    return(\r\n\r\n        <>\r\n        <div id=\"modal1\" class=\"modal\">\r\n        <div class=\"modal-content\">\r\n          <h4>Подтверждение действия</h4>\r\n          <p>Вы точно хотите удалить?</p>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n        <a  href=\"#!\" class=\"modal-close waves-effect waves-green btn-flat\">Закрыть</a>\r\n          <a onClick={deleteHandler} href=\"#!\" class=\"modal-close waves-effect waves-green btn-flat\">Согласен</a>\r\n        </div>\r\n    </div>\r\n          <div className=\"row\">\r\n            \r\n            <div className=\"adm-form col s12 m12\">\r\n           \r\n                <form onSubmit={submitHandler} method=\"post\" enctype=\"multipart/form-data\">\r\n               \r\n                        <GalleryCategoryFormFields \r\n                         changeHandler={changeHandler} \r\n                         state={form} \r\n                         handleImageChange={handleImageChange}\r\n                         handleSearch={handleSearch}\r\n                         handleSelect={handleSelect}\r\n                         title=\"Обновление данных события\"\r\n                         categories={categories}\r\n                         stateSearch={searchTerm}\r\n                         categoryId={categoryId}\r\n                         currentRoute={currentRoute}/>\r\n                     <div className=\"row\">\r\n                    <div  className=\"input-field col s3 offset-s5  m2 offset-m5  l1 offset-l4  btn-form\">\r\n                        <button onClick={updateHandler} type=\"submit\" className=\"btn blue waves-effect waves-light\">Обновить</button>\r\n                    </div>\r\n                   \r\n                           \r\n                    </div>\r\n                </form>\r\n                <div  className=\"form-delete col s1 offset-s5  m1 offset-m5  l1 offset-l4 \">\r\n                     <form onSubmit={submitHandler} method=\"post\">\r\n                        <button \r\n                        type=\"submit\" \r\n                        className=\"btn red accent-3 waves-effect waves-light modal-trigger\" \r\n                        data-target=\"modal1\">Удалить</button> \r\n                    </form> \r\n            </div>           \r\n            </div>\r\n        </div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default GalleryCategoryFormEdit"]},"metadata":{},"sourceType":"module"}