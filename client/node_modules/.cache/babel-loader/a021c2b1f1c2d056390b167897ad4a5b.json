{"ast":null,"code":"import _defineProperty from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/react projects/reactExpress/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext,useCallback}from\"react\";import{AuthContext}from'../context/AuthContext';import{useHttp}from\"../hooks/http.hook\";import{useMessage}from\"../hooks/message.hook\";import{useHistory}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Login(params){var history=useHistory();var auth=useContext(AuthContext);var message=useMessage();var _useHttp=useHttp(),loading=_useHttp.loading,error=_useHttp.error,request=_useHttp.request,clearError=_useHttp.clearError;var _useState=useState({login:'',password:''}),_useState2=_slicedToArray(_useState,2),form=_useState2[0],setForm=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),disabled=_useState4[0],setDisabled=_useState4[1];useEffect(function(){window.M.updateTextFields();});useEffect(function(){message(error);clearError();},[error,message,clearError]);var fetchUsers=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var fetched;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return request('/api/auth/users','GET',null);case 3:fetched=_context.sent;if(fetched!==null){setDisabled(true);}_context.next=9;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);case 9:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);})),[request]);useEffect(function(){fetchUsers();},[fetchUsers]);var changeHandler=function changeHandler(e){setForm(_objectSpread(_objectSpread({},form),{},_defineProperty({},e.target.name,e.target.value)));};var registerHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return request('/api/auth/register','POST',_objectSpread({},form),{},\"application/json\");case 3:data=_context2.sent;message(data.message);_context2.next=9;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);case 9:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function registerHandler(){return _ref2.apply(this,arguments);};}();var loginHandler=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return request('/api/auth/login','POST',_objectSpread({},form),{},\"application/json\");case 3:data=_context3.sent;auth.login(data.token,data.userId);history.push(\"/admpage\");_context3.next=10;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function loginHandler(){return _ref3.apply(this,arguments);};}();function submitHandler(event){event.preventDefault();}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container \",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u0412\\u0445\\u043E\\u0434\"}),/*#__PURE__*/_jsx(\"form\",{className:\"login-form\",onSubmit:submitHandler,children:/*#__PURE__*/_jsxs(\"div\",{className:\"row \",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"input-field col s12 m5 offset-m3\",children:[/*#__PURE__*/_jsx(\"input\",{value:form.login,onChange:changeHandler,id:\"login\",name:\"login\",type:\"text\"}),/*#__PURE__*/_jsx(\"label\",{for:\"login\",children:\"\\u041B\\u043E\\u0433\\u0438\\u043D\"})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"input-field col s12 m5 offset-m3\",children:[/*#__PURE__*/_jsx(\"input\",{value:form.password,onChange:changeHandler,id:\"password\",name:\"password\",type:\"password\"}),/*#__PURE__*/_jsx(\"label\",{for:\"password\",children:\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col s6 m1 offset-m5 offset-s4\",children:/*#__PURE__*/_jsx(\"button\",{disabled:loading,onClick:loginHandler,className:\"btn waves-effect blue waves-light red darken-3\",type:\"submit\",children:\"\\u0412\\u043E\\u0439\\u0442\\u0438\"})}),!disabled&&/*#__PURE__*/_jsx(\"div\",{className:\"col s6 m1 offset-m5 offset-s4\",children:/*#__PURE__*/_jsx(\"button\",{disabled:loading||disabled,onClick:registerHandler,className:\"btn waves-effect waves-light green darken-3\",type:\"submit\",children:\"\\u0420\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F\"})})]})})]})});}export default Login;","map":{"version":3,"sources":["C:/react projects/reactExpress/client/src/Pages/Login.js"],"names":["React","useState","useEffect","useContext","useCallback","AuthContext","useHttp","useMessage","useHistory","Login","params","history","auth","message","loading","error","request","clearError","login","password","form","setForm","disabled","setDisabled","window","M","updateTextFields","fetchUsers","fetched","changeHandler","e","target","name","value","registerHandler","data","loginHandler","token","userId","push","submitHandler","event","preventDefault"],"mappings":"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","sourcesContent":["import React,{useState,useEffect, useContext,useCallback} from \"react\";\r\nimport { AuthContext } from '../context/AuthContext'\r\nimport {useHttp} from \"../hooks/http.hook\" \r\nimport {useMessage} from \"../hooks/message.hook\"\r\nimport {useHistory} from \"react-router-dom\"\r\n\r\n\r\nfunction Login(params) {\r\n    const history = useHistory()\r\n    const auth = useContext(AuthContext)\r\n    const message = useMessage()\r\n    const {loading,error,request,clearError} = useHttp()\r\n    const [form,setForm] = useState({\r\n      login:'',\r\n      password:''\r\n    }) \r\n    const [disabled,setDisabled] = useState(false)\r\n    useEffect(() => {\r\n        window.M.updateTextFields()\r\n      },)\r\n\r\n    useEffect(()=>{\r\n   \r\n        message(error)\r\n        clearError()\r\n      },[error,message,clearError])\r\n\r\n      const fetchUsers = useCallback(async () => {\r\n        try {\r\n            const fetched = await request('/api/auth/users', \r\n            'GET',null,)\r\n            if (fetched!==null){\r\n              setDisabled(true)\r\n            }\r\n           \r\n    } catch (e) {}\r\n  }, [request])\r\n\r\n  useEffect(() => {\r\n    fetchUsers()\r\n    \r\n  }, [fetchUsers]) \r\n     \r\n\r\n      const changeHandler = e=>{\r\n        setForm({...form, [e.target.name]: e.target.value})\r\n      }  \r\n\r\n      const registerHandler= async ()=>{\r\n        try{\r\n          const data=await request('/api/auth/register','POST',{...form},{},\"application/json\")\r\n          message(data.message)\r\n        }catch(e){\r\n  \r\n        }\r\n    }\r\n  \r\n    const loginHandler= async ()=>{\r\n      try{\r\n        const data=await request('/api/auth/login','POST',{...form},{},\"application/json\")\r\n        auth.login(data.token,data.userId)\r\n        history.push(`/admpage`)\r\n      }catch(e){\r\n  \r\n      }\r\n  }\r\n\r\n    function submitHandler(event){\r\n        event.preventDefault()\r\n    }\r\n    return(\r\n        <>\r\n            <div className=\"container \">\r\n                <h4>Вход</h4>\r\n                <form className=\"login-form\" onSubmit={submitHandler}>\r\n                    <div className=\"row \">\r\n                    <div class=\"input-field col s12 m5 offset-m3\">\r\n                        <input value={form.login} onChange={changeHandler} id=\"login\" name=\"login\"  type=\"text\" />\r\n                        <label for=\"login\">Логин</label>\r\n                     </div>\r\n                    <div class=\"input-field col s12 m5 offset-m3\">\r\n                        <input value={form.password} onChange={changeHandler} id=\"password\" name=\"password\" type=\"password\" />\r\n                        <label for=\"password\">Пароль</label>\r\n                     </div>\r\n                     <div className=\"col s6 m1 offset-m5 offset-s4\">\r\n                        <button  disabled={loading} onClick={loginHandler} className=\"btn waves-effect blue waves-light red darken-3\" type=\"submit\">Войти</button>\r\n                     </div>\r\n                     {!disabled && <div className=\"col s6 m1 offset-m5 offset-s4\">\r\n                        <button  disabled={loading || disabled} onClick={registerHandler} className=\"btn waves-effect waves-light green darken-3\" type=\"submit\">Регистрация</button>\r\n                     </div> }\r\n                     \r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default Login"]},"metadata":{},"sourceType":"module"}